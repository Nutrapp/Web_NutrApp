<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes: <%= produto.nome_gen %> - RotuScan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/viewProduto.css">
    <link rel="stylesheet" href="/css/produtos.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <%-include('./partials/navbar.ejs')%>

        <div class="container mt-5 pt-5">
            <div class="product-detail-card">
                <div class="row g-4">
                    <div class="col-md-5 product-image-col text-center">
                        <img src="<%= produto.url_imagem_produto ? produto.url_imagem_produto : '/img/placeholder.jpg' %>"
                            alt="Imagem de <%= produto.nome_gen %>"
                            onerror="this.onerror=null;this.src='/img/placeholder.jpg';">
                    </div>

                    <div class="col-md-7 product-info-col">
                        <p class="small text-muted mb-3">
                            Cadastrado por:
                            <span class="fw-bold">
                                <%= nomeCadastrador %>
                            </span>
                        </p>

                        <div class="mt-2 p-2 bg-light rounded small">
                            <span class="info-label"></span>
                            <span class="font-monospace">

                            </span>
                        </div>
                        <div class="alert alert-warning alert-dismissible fade show small" role="alert">
                            Esta página exibe os dados disponíveis. Campos como Embalagem e Categorias não estão no
                            modelo
                            atual.
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>

                        <div>
                            <span class="info-label">Código de Barras:</span>
                            <p class="info-value" id="cod-barra-valor" data-cod-barra="<%= produto.cod_barra %>">
                                <%= produto.cod_barra %>
                            </p>

                            <div class="barcode-container">
                                <svg id="barcode"></svg>
                            </div>
                        </div>

                        <div>
                            <span class="info-label">Nome Genérico:</span>
                            <p class="info-value">
                                <%= produto.nome_gen %>
                            </p>
                        </div>

                            <div>
                                <span class="info-label">Quantidade:</span>
                                <p class="info-value">
                                    <%= produto.quantidade %> g
                                </p>
                            </div>
        
                                <div>
                                    <span class="info-label">Marca:</span>
                                    <p class="info-value">
                                        <%= produto.marca_produto %>
                                    </p>
                                </div>

                                <div class="mt-2 p-2 bg-light rounded small">
                                    <span class="info-label"></span>
                                    <span class="font-monospace">
                                    </span>
                                </div>

                                <div class="mt-4 d-flex justify-content-end gap-2">
                                    <a href="/produtos" class="btn btn-secondary">Voltar para Lista</a>

                                    <% const isOwner=typeof usuarioLogado !=='undefined' && usuarioLogado &&
                                        usuarioLogado.id && produto.usuario_id_fk &&
                                        String(usuarioLogado.id)===String(produto.usuario_id_fk); %>
                                        <% if (isOwner) { %>
                                            <a href="/produto/edit/<%= produto.id %>" class="btn btn-edit-custom">
                                                <i class="fas fa-edit"></i> Editar
                                            </a>
                                            <form action="/produtos/delete/<%= produto.id %>" method="POST"
                                                onsubmit="return confirm('ATENÇÃO: Você tem certeza que deseja excluir este produto? Essa ação é irreversível.')"
                                                style="display: inline;">
                                                <button type="submit" class="btn btn-delete-custom">
                                                    <i class="fas fa-trash"></i> Excluir
                                                </button>
                                            </form>
                                            <% } else if (typeof usuarioLogado !=='undefined' && usuarioLogado) { %>

                                                <% } else { %>
                                                    <% } %>
                                </div>

                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
        <script src="/js/script.js"></script>
        <script src="/js/editProduto.js"></script>

</body>

</html>